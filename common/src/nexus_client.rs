/*!
 * Interface for making API requests to the Oxide control plane at large
 * from within the control plane
 *
 * This should be replaced with a client generated from the OpenAPI spec
 * generated by the server.
 */

// use crate::api::external::Error;
// use crate::api::internal::nexus::DiskRuntimeState;
// use crate::api::internal::nexus::InstanceRuntimeState;
// use crate::api::internal::nexus::SledAgentStartupInfo;
// use http::Method;
// use hyper::Body;
// use progenitor::generate_api;
// use slog::Logger;
// use std::net::SocketAddr;
// use uuid::Uuid;

generate_logging_api!("../openapi/nexus-internal.json");

// TODO
pub trait GenNext {
    fn next(&self) -> types::Generation;
}

impl GenNext for types::Generation {
    fn next(&self) -> types::Generation {
        todo!()
    }
}

impl From<types::Generation> for crate::api::external::Generation {
    fn from(_: types::Generation) -> Self {
        todo!()
    }
}

pub trait InstanceStateExt {
    fn is_stopped(&self) -> bool;
}

impl InstanceStateExt for types::InstanceState {
    fn is_stopped(&self) -> bool {
        todo!();
    }
}

impl From<crate::api::external::ByteCount> for types::ByteCount {
    fn from(x: crate::api::external::ByteCount) -> Self {
        Self(x.to_bytes())
    }
}

impl From<types::DiskState> for crate::api::external::DiskState {
    fn from(val: types::DiskState) -> Self {
        todo!()
    }
}

impl From<types::InstanceState> for crate::api::external::InstanceState {
    fn from(_: types::InstanceState) -> Self {
        todo!()
    }
}

// impl From<types::InstanceRuntimeState>
//     for crate::api::internal::common::InstanceRuntimeState
// {
//     fn from(_: types::InstanceRuntimeState) -> Self {
//         todo!()
//     }
// }

// impl From<types::DiskRuntimeState>
//     for crate::api::internal::common::DiskRuntimeState
// {
//     fn from(_: types::DiskRuntimeState) -> Self {
//         todo!()
//     }
// }

/*
/** Client for a nexus instance */
pub struct Client {
    /** underlying HTTP client */
    client: HttpClient,
}

impl Client {
    /**
     * Create a new nexus client to make requests to the Nexus instance at
     * `server_addr`.
     */
    pub fn new(server_addr: SocketAddr, log: Logger) -> Client {
        Client { client: HttpClient::new("nexus", server_addr, log) }
    }

    /**
     * Publish information about a sled agent's startup.
     */
    pub async fn notify_sled_agent_online(
        &self,
        id: Uuid,
        info: SledAgentStartupInfo,
    ) -> Result<(), Error> {
        let path = format!("/sled_agents/{}", id);
        let body = Body::from(serde_json::to_string(&info).unwrap());
        self.client.request(Method::POST, path.as_str(), body).await.map(|_| ())
    }

    /**
     * Publish an updated runtime state for an Instance.
     */
    pub async fn notify_instance_updated(
        &self,
        id: &Uuid,
        new_runtime_state: &InstanceRuntimeState,
    ) -> Result<(), Error> {
        let path = format!("/instances/{}", id);
        let body =
            Body::from(serde_json::to_string(new_runtime_state).unwrap());
        self.client.request(Method::PUT, path.as_str(), body).await.map(|_| ())
    }

    /**
     * Publish an updated runtime state for a Disk.
     */
    pub async fn notify_disk_updated(
        &self,
        id: &Uuid,
        new_state: &DiskRuntimeState,
    ) -> Result<(), Error> {
        let path = format!("/disks/{}", id);
        let body = Body::from(serde_json::to_string(new_state).unwrap());
        self.client.request(Method::PUT, path.as_str(), body).await.map(|_| ())
    }
}

*/
