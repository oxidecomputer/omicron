#!/bin/bash
#
# This script fetches the following from CI
#
#   - the softnpu ASIC simulator (softnpu)
#   - a softnpu admin program (scadm)
#   - the sidecar-lite precompiled P4 program
#

# This is the softnpu ASIC emulator
if [[ ! -f out/softnpu/softnpu ]]; then
    echo "fetching softnpu"
    curl -OL https://buildomat.eng.oxide.computer/wg/0/artefact/01GTD3CPEENJZ9K1VA0J3GYD5D/WZ2Rw4MGOeSr06SEfmyuMfsp7i5rgwzvENWnAUjShI8FGryp/01GTD3D91TCD903Z0BAYSA31JR/01GTD3T8VFSZTE59Y0SVAR4CWC/softnpu
    chmod +x softnpu
    mkdir -p out/softnpu
    mv softnpu out/softnpu/
fi

# This is an ASIC administration program.
if [[ ! -f out/softnpu/scadm ]]; then
    echo "fetching scadm"
    curl -OL https://buildomat.eng.oxide.computer/wg/0/artefact/01GWSY546C4ZB2XX2XQRPZN3XW/5VRexYs05eSHBr5LlMpyAZl5OugmF27PrnIjIGhC4R5pTgj5/01GWSY5HPK4TA9TBWJZVM1A27A/01GWSYK8QBC3YR54XZ2RXABWMV/scadm
    chmod +x scadm
    mv scadm out/softnpu/
fi

# Fetch the pre-compiled sidecar_lite p4 program
if [[ ! -f out/softnpu/libsidecar_lite.so ]]; then
    echo "fetching libsidecar_lite.so"
    curl -OL https://buildomat.eng.oxide.computer/wg/0/artefact/01GWSY546C4ZB2XX2XQRPZN3XW/5VRexYs05eSHBr5LlMpyAZl5OugmF27PrnIjIGhC4R5pTgj5/01GWSY5HPK4TA9TBWJZVM1A27A/01GWSYK12R9F6DGTN4R9YMS17F/libsidecar_lite.so
    mv libsidecar_lite.so out/softnpu/
fi
