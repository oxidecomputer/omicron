{
  "openapi": "3.0.3",
  "info": {
    "title": "Oxide Installinator Artifact Server",
    "description": "API for use by the installinator to retrieve artifacts",
    "contact": {
      "url": "https://oxide.computer",
      "email": "api@oxide.computer"
    },
    "version": "0.0.1"
  },
  "paths": {
    "/artifacts/by-hash/{kind}/{hash}": {
      "get": {
        "summary": "Fetch an artifact by hash.",
        "operationId": "get_artifact_by_hash",
        "parameters": [
          {
            "in": "path",
            "name": "hash",
            "description": "The hash of the artifact.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "hex string (32 bytes)"
            }
          },
          {
            "in": "path",
            "name": "kind",
            "description": "The kind of artifact this is.",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "*/*": {
                "schema": {}
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/artifacts/by-id/{kind}/{name}/{version}": {
      "get": {
        "summary": "Fetch an artifact from this server.",
        "operationId": "get_artifact_by_id",
        "parameters": [
          {
            "in": "path",
            "name": "kind",
            "description": "The kind of artifact this is.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "name",
            "description": "The artifact's name.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "version",
            "description": "The artifact's version.",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/SemverVersion"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "*/*": {
                "schema": {}
              }
            }
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    },
    "/report-progress/{update_id}": {
      "post": {
        "summary": "Report progress and completion to the server.",
        "description": "This method requires an `update_id` path parameter. This update ID is matched against the server currently performing an update. If the server is unaware of the update ID, it will return an HTTP 422 Unprocessable Entity code.",
        "operationId": "report_progress",
        "parameters": [
          {
            "in": "path",
            "name": "update_id",
            "description": "A unique identifier for the update.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EventReportForInstallinatorSpec"
              }
            }
          },
          "required": true
        },
        "responses": {
          "204": {
            "description": "resource updated"
          },
          "4XX": {
            "$ref": "#/components/responses/Error"
          },
          "5XX": {
            "$ref": "#/components/responses/Error"
          }
        }
      }
    }
  },
  "components": {
    "responses": {
      "Error": {
        "description": "Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            }
          }
        }
      }
    },
    "schemas": {
      "Duration": {
        "type": "object",
        "properties": {
          "nanos": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0
          },
          "secs": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          }
        },
        "required": [
          "nanos",
          "secs"
        ]
      },
      "Error": {
        "description": "Error information from a response.",
        "type": "object",
        "properties": {
          "error_code": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "request_id": {
            "type": "string"
          }
        },
        "required": [
          "message",
          "request_id"
        ]
      },
      "EventReportForInstallinatorSpec": {
        "description": "A report produced from an [`EventBuffer`](crate::EventBuffer).\n\nRemote reports can be passed into a [`StepContext`](crate::StepContext), in which case they show up as nested events.",
        "type": "object",
        "properties": {
          "last_seen": {
            "nullable": true,
            "description": "The last event seen.\n\n`last_seen` can be used to retrieve deltas of events.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "progress_events": {
            "description": "A list of progress events, or whether we're currently waiting for a progress event.\n\nCurrently, this produces one progress event for each top-level and nested event in progress.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProgressEventForInstallinatorSpec"
            }
          },
          "root_execution_id": {
            "nullable": true,
            "description": "The root execution ID for this report.\n\nEach report has a root execution ID, which ties together all step and progress events. This is always filled out if the list of step events is non-empty.",
            "type": "string",
            "format": "uuid"
          },
          "step_events": {
            "description": "A list of step events.\n\nStep events include success and failure events.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/StepEventForInstallinatorSpec"
            }
          }
        },
        "required": [
          "progress_events",
          "step_events"
        ]
      },
      "InstallinatorCompletionMetadata": {
        "oneOf": [
          {
            "type": "object",
            "properties": {
              "disks_found": {
                "description": "Number of disks found.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "reason": {
                "type": "string",
                "enum": [
                  "hardware_scan"
                ]
              }
            },
            "required": [
              "disks_found",
              "reason"
            ]
          },
          {
            "type": "object",
            "properties": {
              "reason": {
                "type": "string",
                "enum": [
                  "control_plane_zones"
                ]
              },
              "zones_to_install": {
                "description": "Number of zone images that will be installed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              }
            },
            "required": [
              "reason",
              "zones_to_install"
            ]
          },
          {
            "type": "object",
            "properties": {
              "address": {
                "description": "The address the artifact was downloaded from.",
                "type": "string"
              },
              "reason": {
                "type": "string",
                "enum": [
                  "download"
                ]
              }
            },
            "required": [
              "address",
              "reason"
            ]
          },
          {
            "type": "object",
            "properties": {
              "output": {
                "description": "The output of the write operation.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/WriteOutput"
                  }
                ]
              },
              "reason": {
                "type": "string",
                "enum": [
                  "write"
                ]
              }
            },
            "required": [
              "output",
              "reason"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "reason": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "reason"
            ]
          }
        ]
      },
      "InstallinatorComponent": {
        "description": "Installinator components.",
        "oneOf": [
          {
            "description": "The host phase 2 component.",
            "type": "string",
            "enum": [
              "host_phase2"
            ]
          },
          {
            "description": "The control plane component.",
            "type": "string",
            "enum": [
              "control_plane"
            ]
          },
          {
            "description": "A component that means \"both the host and the control plane\", used for writes for now. It is possible that this component will go away in the future.",
            "type": "string",
            "enum": [
              "both"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "string",
            "enum": [
              "unknown"
            ]
          }
        ]
      },
      "InstallinatorProgressMetadata": {
        "oneOf": [
          {
            "type": "object",
            "properties": {
              "peer": {
                "description": "The peer being downloaded from.\n\nAvailable with downlad events.",
                "type": "string"
              },
              "reason": {
                "type": "string",
                "enum": [
                  "download"
                ]
              }
            },
            "required": [
              "peer",
              "reason"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "reason": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "reason"
            ]
          }
        ]
      },
      "InstallinatorStepId": {
        "description": "Installinator step identifier.",
        "type": "string",
        "enum": [
          "download",
          "format",
          "scan",
          "unpack_control_plane_artifact",
          "write"
        ]
      },
      "InstallinatorStepMetadata": {
        "oneOf": [
          {
            "type": "object",
            "properties": {
              "destination": {
                "nullable": true,
                "description": "The destination being formatted or written to.\n\nAvailable with format and destination events.",
                "type": "string",
                "format": "Utf8PathBuf"
              },
              "reason": {
                "type": "string",
                "enum": [
                  "write"
                ]
              }
            },
            "required": [
              "destination",
              "reason"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "reason": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "reason"
            ]
          }
        ]
      },
      "M2Slot": {
        "description": "An M.2 slot that was written.",
        "type": "string",
        "enum": [
          "A",
          "B"
        ]
      },
      "ProgressCounter": {
        "description": "Current progress.\n\nBoth `current` and `total` are abstract counters. These counters are often a number of bytes. There is no guarantee that the counter won't go back in subsequent events; that can happen e.g. if a fetch happens from multiple peers within a single attempt.",
        "type": "object",
        "properties": {
          "current": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          },
          "total": {
            "nullable": true,
            "type": "integer",
            "format": "uint64",
            "minimum": 0
          }
        },
        "required": [
          "current"
        ]
      },
      "ProgressEventForGenericSpec": {
        "type": "object",
        "properties": {
          "data": {
            "description": "The kind of event this is.",
            "allOf": [
              {
                "$ref": "#/components/schemas/ProgressEventKindForGenericSpec"
              }
            ]
          },
          "execution_id": {
            "description": "The execution ID.",
            "type": "string",
            "format": "uuid"
          },
          "spec": {
            "description": "The specification that this event belongs to.\n\nThis is typically the name of the type `S` for which `StepSpec` is implemented.\n\nThis can be used with `Self::from_generic` to deserialize generic metadata.",
            "type": "string"
          },
          "total_elapsed": {
            "description": "Total time elapsed since the start of execution.",
            "allOf": [
              {
                "$ref": "#/components/schemas/Duration"
              }
            ]
          }
        },
        "required": [
          "data",
          "execution_id",
          "spec",
          "total_elapsed"
        ]
      },
      "ProgressEventForInstallinatorSpec": {
        "type": "object",
        "properties": {
          "data": {
            "description": "The kind of event this is.",
            "allOf": [
              {
                "$ref": "#/components/schemas/ProgressEventKindForInstallinatorSpec"
              }
            ]
          },
          "execution_id": {
            "description": "The execution ID.",
            "type": "string",
            "format": "uuid"
          },
          "spec": {
            "description": "The specification that this event belongs to.\n\nThis is typically the name of the type `S` for which `StepSpec` is implemented.\n\nThis can be used with `Self::from_generic` to deserialize generic metadata.",
            "type": "string"
          },
          "total_elapsed": {
            "description": "Total time elapsed since the start of execution.",
            "allOf": [
              {
                "$ref": "#/components/schemas/Duration"
              }
            ]
          }
        },
        "required": [
          "data",
          "execution_id",
          "spec",
          "total_elapsed"
        ]
      },
      "ProgressEventKindForGenericSpec": {
        "oneOf": [
          {
            "description": "The update engine is waiting for a progress message.\n\nThe update engine sends this message immediately after a [`StepEvent`] corresponding to a new step.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number currently being executed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "Total time elapsed since the start of the attempt.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "waiting_for_progress"
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "step",
              "step_elapsed"
            ]
          },
          {
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number currently being executed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "Total time elapsed since the start of the attempt.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "progress"
                ]
              },
              "metadata": {
                "description": "Metadata that was returned with progress."
              },
              "progress": {
                "nullable": true,
                "description": "Current progress.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/ProgressCounter"
                  }
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "metadata",
              "step",
              "step_elapsed"
            ]
          },
          {
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number currently being executed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "event": {
                "description": "The event that occurred.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/ProgressEventForGenericSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "nested"
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "event",
              "kind",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "kind"
            ]
          }
        ]
      },
      "ProgressEventKindForInstallinatorSpec": {
        "oneOf": [
          {
            "description": "The update engine is waiting for a progress message.\n\nThe update engine sends this message immediately after a [`StepEvent`] corresponding to a new step.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number currently being executed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "Total time elapsed since the start of the attempt.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "waiting_for_progress"
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "step",
              "step_elapsed"
            ]
          },
          {
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number currently being executed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "Total time elapsed since the start of the attempt.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "progress"
                ]
              },
              "metadata": {
                "description": "Metadata that was returned with progress.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/InstallinatorProgressMetadata"
                  }
                ]
              },
              "progress": {
                "nullable": true,
                "description": "Current progress.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/ProgressCounter"
                  }
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "metadata",
              "step",
              "step_elapsed"
            ]
          },
          {
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number currently being executed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "event": {
                "description": "The event that occurred.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/ProgressEventForGenericSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "nested"
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "event",
              "kind",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "kind"
            ]
          }
        ]
      },
      "StepComponentSummaryForGenericSpec": {
        "type": "object",
        "properties": {
          "component": {
            "description": "The component."
          },
          "total_component_steps": {
            "description": "The number of steps present in this component.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          }
        },
        "required": [
          "component",
          "total_component_steps"
        ]
      },
      "StepComponentSummaryForInstallinatorSpec": {
        "type": "object",
        "properties": {
          "component": {
            "description": "The component.",
            "allOf": [
              {
                "$ref": "#/components/schemas/InstallinatorComponent"
              }
            ]
          },
          "total_component_steps": {
            "description": "The number of steps present in this component.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          }
        },
        "required": [
          "component",
          "total_component_steps"
        ]
      },
      "StepEventForGenericSpec": {
        "type": "object",
        "properties": {
          "data": {
            "description": "The kind of event this is.",
            "allOf": [
              {
                "$ref": "#/components/schemas/StepEventKindForGenericSpec"
              }
            ]
          },
          "event_index": {
            "description": "A monotonically increasing index for this `StepEvent`.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "execution_id": {
            "description": "The execution ID.",
            "type": "string",
            "format": "uuid"
          },
          "spec": {
            "description": "The specification that this event belongs to.\n\nThis is typically the name of the type `S` for which `StepSpec` is implemented.\n\nThis can be used along with `Self::from_generic` to identify which specification to deserialize generic metadata against. For example:\n\n```rust,ignore if event.spec == \"MySpec\" { // event is likely generated from a MySpec engine. let event = Event::<MySpec>::from_generic(event)?; // ... } ```",
            "type": "string"
          },
          "total_elapsed": {
            "description": "Total time elapsed since the start of execution.",
            "allOf": [
              {
                "$ref": "#/components/schemas/Duration"
              }
            ]
          }
        },
        "required": [
          "data",
          "event_index",
          "execution_id",
          "spec",
          "total_elapsed"
        ]
      },
      "StepEventForInstallinatorSpec": {
        "type": "object",
        "properties": {
          "data": {
            "description": "The kind of event this is.",
            "allOf": [
              {
                "$ref": "#/components/schemas/StepEventKindForInstallinatorSpec"
              }
            ]
          },
          "event_index": {
            "description": "A monotonically increasing index for this `StepEvent`.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "execution_id": {
            "description": "The execution ID.",
            "type": "string",
            "format": "uuid"
          },
          "spec": {
            "description": "The specification that this event belongs to.\n\nThis is typically the name of the type `S` for which `StepSpec` is implemented.\n\nThis can be used along with `Self::from_generic` to identify which specification to deserialize generic metadata against. For example:\n\n```rust,ignore if event.spec == \"MySpec\" { // event is likely generated from a MySpec engine. let event = Event::<MySpec>::from_generic(event)?; // ... } ```",
            "type": "string"
          },
          "total_elapsed": {
            "description": "Total time elapsed since the start of execution.",
            "allOf": [
              {
                "$ref": "#/components/schemas/Duration"
              }
            ]
          }
        },
        "required": [
          "data",
          "event_index",
          "execution_id",
          "spec",
          "total_elapsed"
        ]
      },
      "StepEventKindForGenericSpec": {
        "oneOf": [
          {
            "description": "No steps were defined, and the executor exited without doing anything.\n\nThis is a terminal event: it is guaranteed that no more events will be seen after this one.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "no_steps_defined"
                ]
              }
            },
            "required": [
              "kind"
            ]
          },
          {
            "description": "Execution was started.\n\nThis is an initial event -- it is always expected to be the first event received from the event stream.",
            "type": "object",
            "properties": {
              "components": {
                "description": "A list of components, along with the number of items each component has.",
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/StepComponentSummaryForGenericSpec"
                }
              },
              "first_step": {
                "description": "Information about the first step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "execution_started"
                ]
              },
              "steps": {
                "description": "The list of steps that will be executed.",
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/StepInfoForGenericSpec"
                }
              }
            },
            "required": [
              "components",
              "first_step",
              "kind",
              "steps"
            ]
          },
          {
            "description": "Progress was reset along an attempt, and this attempt is going down a different path.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The current attempt number.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The amount of time this attempt has taken so far.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "progress_reset"
                ]
              },
              "message": {
                "description": "A message assocaited with the reset.",
                "type": "string"
              },
              "metadata": {
                "description": "Progress-related metadata associated with this attempt."
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "message",
              "metadata",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "An attempt failed and this step is being retried.",
            "type": "object",
            "properties": {
              "attempt_elapsed": {
                "description": "The amount of time the previous attempt took.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "attempt_retry"
                ]
              },
              "message": {
                "description": "A message associated with the retry.",
                "type": "string"
              },
              "next_attempt": {
                "description": "The attempt number for the next attempt.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt_elapsed",
              "kind",
              "message",
              "next_attempt",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "A step is complete and the next step has been started.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number that completed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "step_completed"
                ]
              },
              "next_step": {
                "description": "The next step that is being started.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "outcome": {
                "description": "The outcome of the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepOutcomeForGenericSpec"
                  }
                ]
              },
              "step": {
                "description": "Information about the step that just completed.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "next_step",
              "outcome",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "Execution is complete.\n\nThis is a terminal event: it is guaranteed that no more events will be seen after this one.",
            "type": "object",
            "properties": {
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "execution_completed"
                ]
              },
              "last_attempt": {
                "description": "The attempt number that completed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "last_outcome": {
                "description": "The outcome of the last step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepOutcomeForGenericSpec"
                  }
                ]
              },
              "last_step": {
                "description": "Information about the last step that completed.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt_elapsed",
              "kind",
              "last_attempt",
              "last_outcome",
              "last_step",
              "step_elapsed"
            ]
          },
          {
            "description": "Execution failed.\n\nThis is a terminal event: it is guaranteed that no more events will be seen after this one.",
            "type": "object",
            "properties": {
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "causes": {
                "description": "A chain of causes associated with the failure.",
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "failed_step": {
                "description": "Information about the step that failed.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "execution_failed"
                ]
              },
              "message": {
                "description": "A message associated with the failure.",
                "type": "string"
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "total_attempts": {
                "description": "The total number of attempts that were performed before the step failed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              }
            },
            "required": [
              "attempt_elapsed",
              "causes",
              "failed_step",
              "kind",
              "message",
              "step_elapsed",
              "total_attempts"
            ]
          },
          {
            "description": "A nested step event occurred.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The current attempt number.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "event": {
                "description": "The event that occurred.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepEventForGenericSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "nested"
                ]
              },
              "step": {
                "description": "Information about the step that's occurring.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForGenericSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "event",
              "kind",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "kind"
            ]
          }
        ]
      },
      "StepEventKindForInstallinatorSpec": {
        "oneOf": [
          {
            "description": "No steps were defined, and the executor exited without doing anything.\n\nThis is a terminal event: it is guaranteed that no more events will be seen after this one.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "no_steps_defined"
                ]
              }
            },
            "required": [
              "kind"
            ]
          },
          {
            "description": "Execution was started.\n\nThis is an initial event -- it is always expected to be the first event received from the event stream.",
            "type": "object",
            "properties": {
              "components": {
                "description": "A list of components, along with the number of items each component has.",
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/StepComponentSummaryForInstallinatorSpec"
                }
              },
              "first_step": {
                "description": "Information about the first step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "execution_started"
                ]
              },
              "steps": {
                "description": "The list of steps that will be executed.",
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/StepInfoForInstallinatorSpec"
                }
              }
            },
            "required": [
              "components",
              "first_step",
              "kind",
              "steps"
            ]
          },
          {
            "description": "Progress was reset along an attempt, and this attempt is going down a different path.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The current attempt number.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The amount of time this attempt has taken so far.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "progress_reset"
                ]
              },
              "message": {
                "description": "A message assocaited with the reset.",
                "type": "string"
              },
              "metadata": {
                "description": "Progress-related metadata associated with this attempt.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/InstallinatorProgressMetadata"
                  }
                ]
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "message",
              "metadata",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "An attempt failed and this step is being retried.",
            "type": "object",
            "properties": {
              "attempt_elapsed": {
                "description": "The amount of time the previous attempt took.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "attempt_retry"
                ]
              },
              "message": {
                "description": "A message associated with the retry.",
                "type": "string"
              },
              "next_attempt": {
                "description": "The attempt number for the next attempt.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "step": {
                "description": "Information about the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt_elapsed",
              "kind",
              "message",
              "next_attempt",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "A step is complete and the next step has been started.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The attempt number that completed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "step_completed"
                ]
              },
              "next_step": {
                "description": "The next step that is being started.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "outcome": {
                "description": "The outcome of the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepOutcomeForInstallinatorSpec"
                  }
                ]
              },
              "step": {
                "description": "Information about the step that just completed.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "kind",
              "next_step",
              "outcome",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "Execution is complete.\n\nThis is a terminal event: it is guaranteed that no more events will be seen after this one.",
            "type": "object",
            "properties": {
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "execution_completed"
                ]
              },
              "last_attempt": {
                "description": "The attempt number that completed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "last_outcome": {
                "description": "The outcome of the last step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepOutcomeForInstallinatorSpec"
                  }
                ]
              },
              "last_step": {
                "description": "Information about the last step that completed.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt_elapsed",
              "kind",
              "last_attempt",
              "last_outcome",
              "last_step",
              "step_elapsed"
            ]
          },
          {
            "description": "Execution failed.\n\nThis is a terminal event: it is guaranteed that no more events will be seen after this one.",
            "type": "object",
            "properties": {
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "causes": {
                "description": "A chain of causes associated with the failure.",
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "failed_step": {
                "description": "Information about the step that failed.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "execution_failed"
                ]
              },
              "message": {
                "description": "A message associated with the failure.",
                "type": "string"
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "total_attempts": {
                "description": "The total number of attempts that were performed before the step failed.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              }
            },
            "required": [
              "attempt_elapsed",
              "causes",
              "failed_step",
              "kind",
              "message",
              "step_elapsed",
              "total_attempts"
            ]
          },
          {
            "description": "A nested step event occurred.",
            "type": "object",
            "properties": {
              "attempt": {
                "description": "The current attempt number.",
                "type": "integer",
                "format": "uint",
                "minimum": 0
              },
              "attempt_elapsed": {
                "description": "The time it took for this attempt to complete.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              },
              "event": {
                "description": "The event that occurred.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepEventForGenericSpec"
                  }
                ]
              },
              "kind": {
                "type": "string",
                "enum": [
                  "nested"
                ]
              },
              "step": {
                "description": "Information about the step that's occurring.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/StepInfoWithMetadataForInstallinatorSpec"
                  }
                ]
              },
              "step_elapsed": {
                "description": "Total time elapsed since the start of the step. Includes prior attempts.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/Duration"
                  }
                ]
              }
            },
            "required": [
              "attempt",
              "attempt_elapsed",
              "event",
              "kind",
              "step",
              "step_elapsed"
            ]
          },
          {
            "description": "Future variants that might be unknown.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "unknown"
                ]
              }
            },
            "required": [
              "kind"
            ]
          }
        ]
      },
      "StepInfoForGenericSpec": {
        "description": "Serializable information about a step.",
        "type": "object",
        "properties": {
          "component": {
            "description": "The component that this step is part of."
          },
          "component_index": {
            "description": "The index of the step within the component.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "description": {
            "description": "The description for this step.",
            "type": "string"
          },
          "id": {
            "description": "An identifier for this step."
          },
          "index": {
            "description": "The index of the step within all steps to be executed.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "total_component_steps": {
            "description": "The total number of steps in this component.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          }
        },
        "required": [
          "component",
          "component_index",
          "description",
          "id",
          "index",
          "total_component_steps"
        ]
      },
      "StepInfoForInstallinatorSpec": {
        "description": "Serializable information about a step.",
        "type": "object",
        "properties": {
          "component": {
            "description": "The component that this step is part of.",
            "allOf": [
              {
                "$ref": "#/components/schemas/InstallinatorComponent"
              }
            ]
          },
          "component_index": {
            "description": "The index of the step within the component.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "description": {
            "description": "The description for this step.",
            "type": "string"
          },
          "id": {
            "description": "An identifier for this step.",
            "allOf": [
              {
                "$ref": "#/components/schemas/InstallinatorStepId"
              }
            ]
          },
          "index": {
            "description": "The index of the step within all steps to be executed.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          },
          "total_component_steps": {
            "description": "The total number of steps in this component.",
            "type": "integer",
            "format": "uint",
            "minimum": 0
          }
        },
        "required": [
          "component",
          "component_index",
          "description",
          "id",
          "index",
          "total_component_steps"
        ]
      },
      "StepInfoWithMetadataForGenericSpec": {
        "description": "Serializable information about a step.",
        "type": "object",
        "properties": {
          "info": {
            "description": "Information about this step.",
            "allOf": [
              {
                "$ref": "#/components/schemas/StepInfoForGenericSpec"
              }
            ]
          },
          "metadata": {
            "nullable": true,
            "description": "Additional metadata associated with this step."
          }
        },
        "required": [
          "info"
        ]
      },
      "StepInfoWithMetadataForInstallinatorSpec": {
        "description": "Serializable information about a step.",
        "type": "object",
        "properties": {
          "info": {
            "description": "Information about this step.",
            "allOf": [
              {
                "$ref": "#/components/schemas/StepInfoForInstallinatorSpec"
              }
            ]
          },
          "metadata": {
            "nullable": true,
            "description": "Additional metadata associated with this step.",
            "allOf": [
              {
                "$ref": "#/components/schemas/InstallinatorStepMetadata"
              }
            ]
          }
        },
        "required": [
          "info"
        ]
      },
      "StepOutcomeForGenericSpec": {
        "oneOf": [
          {
            "description": "The step completed successfully.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "success"
                ]
              },
              "message": {
                "nullable": true,
                "description": "An optional message associated with this step.",
                "type": "string"
              },
              "metadata": {
                "nullable": true,
                "description": "Optional completion metadata associated with the step."
              }
            },
            "required": [
              "kind"
            ]
          },
          {
            "description": "The step completed with a warning.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "warning"
                ]
              },
              "message": {
                "description": "A warning message.",
                "type": "string"
              },
              "metadata": {
                "nullable": true,
                "description": "Optional completion metadata associated with the step."
              }
            },
            "required": [
              "kind",
              "message"
            ]
          },
          {
            "description": "The step was skipped with a message.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "skipped"
                ]
              },
              "message": {
                "description": "Message associated with the skip.",
                "type": "string"
              },
              "metadata": {
                "nullable": true,
                "description": "Optional metadata associated with the skip."
              }
            },
            "required": [
              "kind",
              "message"
            ]
          }
        ]
      },
      "StepOutcomeForInstallinatorSpec": {
        "oneOf": [
          {
            "description": "The step completed successfully.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "success"
                ]
              },
              "message": {
                "nullable": true,
                "description": "An optional message associated with this step.",
                "type": "string"
              },
              "metadata": {
                "nullable": true,
                "description": "Optional completion metadata associated with the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/InstallinatorCompletionMetadata"
                  }
                ]
              }
            },
            "required": [
              "kind"
            ]
          },
          {
            "description": "The step completed with a warning.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "warning"
                ]
              },
              "message": {
                "description": "A warning message.",
                "type": "string"
              },
              "metadata": {
                "nullable": true,
                "description": "Optional completion metadata associated with the step.",
                "allOf": [
                  {
                    "$ref": "#/components/schemas/InstallinatorCompletionMetadata"
                  }
                ]
              }
            },
            "required": [
              "kind",
              "message"
            ]
          },
          {
            "description": "The step was skipped with a message.",
            "type": "object",
            "properties": {
              "kind": {
                "type": "string",
                "enum": [
                  "skipped"
                ]
              },
              "message": {
                "description": "Message associated with the skip.",
                "type": "string"
              },
              "metadata": {
                "nullable": true,
                "description": "Optional metadata associated with the skip."
              }
            },
            "required": [
              "kind",
              "message"
            ]
          }
        ]
      },
      "WriteOutput": {
        "description": "The output of a write operation.\n\nForms part of [`InstallinatorCompletionMetadata::Write`].",
        "type": "object",
        "properties": {
          "slots_attempted": {
            "description": "The slots that were requested to be written.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/M2Slot"
            },
            "uniqueItems": true
          },
          "slots_written": {
            "description": "The slots that were actually written.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/M2Slot"
            },
            "uniqueItems": true
          }
        },
        "required": [
          "slots_attempted",
          "slots_written"
        ]
      },
      "SemverVersion": {
        "type": "string",
        "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
      }
    }
  }
}