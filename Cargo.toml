[workspace]
members = [
    "bootstore",
    "common",
    "ddm-admin-client",
    "deploy",
    "gateway",
    "gateway/faux-mgs",
    "gateway-cli",
    "gateway-client",
    "gateway-messages",
    "gateway-sp-comms",
    "internal-dns",
    "internal-dns-client",
    "nexus",
    "nexus/authz-macros",
    "nexus/db-macros",
    "nexus/db-model",
    "nexus/defaults",
    "nexus/test-utils",
    "nexus/test-utils-macros",
    "nexus/types",
    "nexus-client",
    "package",
    "rpaths",
    "sled-agent",
    "sled-agent-client",
    "sp-sim",
    "oxide-client",
    "oximeter/oximeter",
    "oximeter/collector",
    "oximeter/db",
    "oximeter/instruments",
    "oximeter/producer",
    "oximeter/oximeter-macro-impl",
    "oximeter-client",
    "test-utils",
]

default-members = [
    "common",
    "ddm-admin-client",
    "deploy",
    "gateway",
    "gateway/faux-mgs",
    "gateway-cli",
    "gateway-client",
    "gateway-messages",
    "gateway-sp-comms",
    "internal-dns",
    "internal-dns-client",
    "nexus",
    "nexus/authz-macros",
    "nexus/db-macros",
    "nexus/db-model",
    "nexus/defaults",
    "nexus/types",
    "package",
    "rpaths",
    "sled-agent",
    "sled-agent-client",
    "sp-sim",
    "oxide-client",
    "oximeter/oximeter",
    "oximeter/collector",
    "oximeter/db",
    "oximeter/instruments",
    "oximeter/producer",
    "oximeter/oximeter-macro-impl",
    "oximeter-client",
    "test-utils",
]
resolver = "2"

[workspace.dependencies]
anyhow = "1.0"
assert_matches = "1.5.0"
async-bb8-diesel = { git = "https://github.com/oxidecomputer/async-bb8-diesel", rev = "7944dafc8a36dc6e20a1405eca59d04662de2bb7" }
async-trait = "0.1.56"
backoff = { version = "0.4.0", features = [ "tokio" ] }
base64 = "0.13.0"
bb8 = "0.8.0"
bcs = "0.1.3"
bincode = "1.3.3"
bytes = "1.2.1"
cfg-if = "1.0"
chrono = { version = "0.4", features = [ "serde" ] }
clap = { version = "3.2", features = ["derive"] }
cookie = "0.16"
criterion = { version = "0.4", features = [ "async_tokio" ] }
crossbeam = "0.8"
crucible-agent-client = { git = "https://github.com/oxidecomputer/crucible", rev = "bacffd142fc38a01fe255407b0c8d5d0aacfe778" }
crucible-client-types = { git = "https://github.com/oxidecomputer/crucible", rev = "bacffd142fc38a01fe255407b0c8d5d0aacfe778" }
derive_more = "0.99.17"
diesel = { version = "2.0.0" }
diesel-dtrace = { git = "https://github.com/oxidecomputer/diesel-dtrace", rev = "18748d9f76c94e1f4400fbec0859b3e77a221a8d" }
dropshot = { git = "https://github.com/oxidecomputer/dropshot", branch = "main", features = [ "usdt-probes" ] }
expectorate = "1.0.5"
fatfs = "0.3.5"
futures = "0.3.24"
headers = "0.3.8"
heck = "0.4"
hex = "0.4.3"
http = "0.2.7"
httptest = "0.15.4"
hyper = "0.14"
indicatif = { version = "0.17.1", features = ["rayon"] }
ipnetwork = "0.20"
itertools = "0.10.5"
lazy_static = "1.4.0"
libc = "0.2.133"
macaddr = { version = "1.0.1", features = [ "serde_std" ]}
mime_guess = "2.0.4"
mockall = "0.11"
newtype_derive = "0.1.6"
num-integer = "0.1.45"
num-traits = "0.2.15"
omicron-zone-package = "0.3.2"
once_cell = "1.15.0"
openapi-lint = { git = "https://github.com/oxidecomputer/openapi-lint", branch = "main" }
openapiv3 = "1.0"
# must match samael's crate!
openssl = "0.10"
openssl-sys = "0.9"
openssl-probe = "0.1.2"
opte-ioctl = { git = "https://github.com/oxidecomputer/opte", rev = "52176b99cc578f5b7b90f9bae8935013f961086c" }
opte = { git = "https://github.com/oxidecomputer/opte", rev = "52176b99cc578f5b7b90f9bae8935013f961086c", features = [ "api", "std" ] }
oso = "0.26"
p256 = "0.9.0"
parse-display = "0.6.0"
percent-encoding = "2.2.0"
postgres-protocol = "0.6.4"
pretty-hex = "0.3.0"
proc-macro2 = "1.0"
progenitor = { git = "https://github.com/oxidecomputer/progenitor" }
progenitor-client = { git = "https://github.com/oxidecomputer/progenitor" }
propolis-client = { git = "https://github.com/oxidecomputer/propolis", rev = "c0776be03bf0928651996eb00ad6f3665e99ebe7" }
proptest = "1.0.0"
quote = "1.0"
rand = "0.8.5"
rayon = "1.5"
ref-cast = "1.0"
regex = "1.6.0"
regress = "0.4.1"
reqwest = { version = "0.11", default-features = false }
ring = "0.16"
samael = { git = "https://github.com/njaremko/samael", features = ["xmlsec"], branch = "master" }
schemars = "0.8.10"
serde = { version = "1.0", default-features = false, features = [ "derive" ] }
serde_derive = "1.0"
serde_json = "1.0.85"
serde_tokenstream = "0.1"
serde_urlencoded = "0.7.1"
serde_with = "2.0.1"
serial_test = "0.9"
sha3 = "0.10.5"
signal-hook = "0.3"
signal-hook-tokio = { version = "0.3", features = [ "futures-v0_3" ] }
sled = "0.34"
slog = { version = "2.7", features = [ "max_level_trace", "release_max_level_debug" ] }
slog-async = "2.7"
slog-dtrace = "0.2"
slog-envlogger = "2.2"
slog-term = "2.9"
smf = "0.2"
sprockets-common = { git = "http://github.com/oxidecomputer/sprockets", rev = "77df31efa5619d0767ffc837ef7468101608aee9" }
sprockets-host = { git = "http://github.com/oxidecomputer/sprockets", rev = "77df31efa5619d0767ffc837ef7468101608aee9" }
sprockets-rot = { git = "http://github.com/oxidecomputer/sprockets", rev = "77df31efa5619d0767ffc837ef7468101608aee9" }
steno = "0.2"
strum = { version = "0.24", features = [ "derive" ] }
subprocess = "0.2.9"
syn = { version = "1.0", features = [ "full", "derive", "extra-traits" ] }
tar = "0.4"
tempdir = "0.3"
tempfile = "3.3"
term = "0.7"
termios = "0.3"
thiserror = "1.0"
tokio = "1.21"
tokio-postgres = { version = "0.7", features = [ "with-chrono-0_4", "with-uuid-1" ] }
tokio-stream = "0.1.10"
tokio-tungstenite = "0.17"
toml = "0.5.9"
tough = { version = "0.12", features = [ "http" ] }
trust-dns-client = "0.22"
trust-dns-proto = "0.22"
trust-dns-resolver = "0.22"
trust-dns-server = "0.22"
trybuild = "1.0.65"
uuid = { version = "1.1.0", default-features = false }
usdt = "0.3"
vsss-rs = { version = "2.0.0", default-features = false, features = ["std"] }
walkdir = "2.3"
zeroize = { version = "1.5.7", features = ["zeroize_derive", "std"] }
zip = { version = "0.6.2", default-features = false, features = ["deflate","bzip2"] }
zone = "0.1"

[profile.dev]
panic = "abort"

# `bindgen` is used by `samael`'s build script; building it with optimizations
# makes that build script run ~5x faster, more than offsetting the additional
# build time added to `bindgen` itself.
[profile.dev.package.bindgen]
opt-level = 3

# `lalrpop` is used by `polar-core`'s build script; building it with
# optimizations makes that build script run ~20x faster, more than offsetting
# the additional build time added to `lalrpop` itself.
[profile.dev.package.lalrpop]
opt-level = 3

[profile.release]
panic = "abort"

#
# It's common during development to use a local copy of dropshot, propolis,
# crucible, or steno in the parent directory.  If you want to use those,
# uncomment one of these blocks.
#
#[patch."https://github.com/oxidecomputer/dropshot"]
#dropshot = { path = "../dropshot/dropshot" }
#[patch."https://github.com/oxidecomputer/steno"]
#steno = { path = "../steno" }
#[patch."https://github.com/oxidecomputer/propolis"]
#propolis-client = { path = "../propolis/lib/propolis-client" }
#[patch."https://github.com/oxidecomputer/crucible"]
#crucible-client-typess = { path = "../crucible/crucible-client-typess" }

#
# Local client generation during development.
#
#[patch."https://github.com/oxidecomputer/progenitor"]
#progenitor = { path = "../progenitor/progenitor" }
#[patch."https://github.com/oxidecomputer/typify"]
#typify = { path = "../typify/typify" }

#
# We maintain a fork of pq-sys to address upstream issues.  See the
# README.oxide.md in the "oxide" branch of our fork for details.
#
[patch.crates-io.pq-sys]
git = 'https://github.com/oxidecomputer/pq-sys'
branch = "oxide/omicron"
