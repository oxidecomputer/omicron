#
# Oxide API: configuration file for test suite
#

[console]
# Directory for static assets. Absolute path or relative to CWD.
static_dir = "tests/static"
cache_control_max_age_minutes = 10
session_idle_timeout_minutes = 60
session_absolute_timeout_minutes = 480

# List of authentication schemes to support.
[authn]
schemes_external = [ "spoof", "session_cookie" ]

#
# NOTE: for the test suite, if mode = "file", the file path MUST be the sentinel
# string "UNUSED".  The actual path will be generated by the test suite for each
# test.
#
[log]
level = "trace"
mode = "file"
if_exists = "fail"
path = "UNUSED"

# Configuration for interacting with the timeseries database. This is overwritten
# by the test suite once ClickHouse starts, with the actual address on which it
# is listening.
[timeseries_db]
address = "[::1]:0"

# Tunable parameters used during tests
[tunables]
# Allow small subnets, so we can test IP address exhaustion easily / quickly
max_vpc_ipv4_subnet_prefix = 29

[runtime]
# Identifier for this instance of Nexus.
# NOTE: The test suite always overrides this.
id = "e6bff1ff-24fb-49dc-a54e-c6a350cd4d6c"

#
# NOTE: for the test suite, the port MUST be 0 (in order to bind to any
# available port) because the test suite will be running many servers
# concurrently.
#
[runtime.dropshot_external]
bind_address = "127.0.0.1:0"
request_body_max_bytes = 1048576

# port must be 0. see above
[runtime.dropshot_internal]
bind_address = "127.0.0.1:0"
request_body_max_bytes = 1048576

[runtime.subnet]
net = "fd00:1122:3344:0100::/56"

#
# NOTE: for the test suite, the database URL will be replaced with one
# appropriate for the database that's started by the test runner.
#
[runtime.database]
type = "from_url"
url = "postgresql://root@127.0.0.1:0/omicron?sslmode=disable"
